---
# vim: set ft=yaml:

- name: Deploy Theodolite
  delegate_to: localhost
  kubernetes.core.helm:
    name: theodolite
    chart_ref: "{{ q('pipe', 'git rev-parse --show-toplevel')[0] }}/charts/theodolite/helm"
    # chart_version: 0.8.2
    wait: true
    release_namespace: default
    values: "{{ lookup('ansible.builtin.template', 'theodolite-values.yaml.j2') | from_yaml }}"

- name: Wait for Theodolite's Kafka to be deployed
  delegate_to: localhost
  shell: kubectl wait kafka theodolite-kafka --for=condition=Ready --timeout=600s
